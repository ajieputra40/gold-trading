<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">


<title>Gold Trading</title>

<script src="https://s3.tradingview.com/tv.js"></script>

<style>

@font-face {
      font-family: 'Norwester';
      src: url('assets/Norwester.7bf226306214181d5e917ed5bda230.9494f841057c7b5cda3da2221562752f.otf');
    }
body{
  margin:0;
  font-family: 'Norwester', sans-serif;
  color:#f5d27a;
}

/* TOP BAR */
.topbar{
  background:#1a1408;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #3a2b0f;
}

.price{
  font-size:20px;
  font-weight:bold;
  color:#ffd700;
}

button{
  background:linear-gradient(90deg,#cfae3c,#ffd700);
  border:none;
  padding:10px 14px;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
  color:#000;
}

/* LAYOUT */
.container{
  display:grid;
  grid-template-columns:1fr 320px;
  height:calc(100vh - 60px);
}

/* CHART */
#chart{
  height:100%;
}

/* SIDE PANEL */
.panel{
  background:#1a1408;
  padding:20px;
  border-left:1px solid #3a2b0f;
}

.panel h3{
  margin-top:0;
  color:#ffd700;
}

.input{
  width:100%;
  padding:10px;
  margin:10px 0;
  background:#2a1f0d;
  border:none;
  color:#fff;
  border-radius:6px;
}

.buy{ background:#2e7d32; color:#fff;}
.sell{ background:#c62828; color:#fff;}

.info{
  font-size:14px;
  margin-top:10px;
}

#positionInfo div{
  display:flex;
  justify-content:space-between;
  margin-top:6px;
}

#plValue.profit{ color:#4caf50; }
#plValue.loss{ color:#f44336; }
  
  
#loading{
  position:fixed;
  inset:0;
  background:#0f0c05;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.spinner{
  width:56px;
  height:56px;
  border-radius:50%;
  border:5px solid rgba(255,215,0,0.2);
  border-top:5px solid #ffd700;
  animation:spin 1s linear infinite;
}

.loading-text{
  margin-top:14px;
  font-size:14px;
  letter-spacing:0.5px;
  color:#c9b37a;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}
</style>
</head>

<body>

  <div id="loading">
    <div class="spinner"></div>
    <div class="loading-text">Loading Gold Market…</div>
  </div>

<div class="topbar">
  <div>Gold Trading (XAUUSD)</div>
  <div class="price" id="goldPrice">$--</div>
</div>

<div class="container">

  <!-- CHART -->
  <div id="chart"></div>

  <!-- TRADE PANEL -->
  <div class="panel">
    <h3>Trade Gold</h3>

    <label>Amount (USD)</label>
    <input id="amount" class="input" type="number" placeholder="100">

    <button class="buy" onclick="buy()">Buy Gold</button>
    <br><br>
    <button class="sell" onclick="sell()">Sell Gold</button>

    <div class="info" id="positionInfo">
      <div>Entry Price: <b id="entryPrice">--</b></div>
      <div>Current Price: <b id="currentPrice">--</b></div>
      <div>P/L: <b id="plValue">--</b></div>
    </div>

    <div class="info" id="result"></div>
  </div>

</div>

<script>

let position = {
  active: false,
  entryPrice: 0,
  amountUsd: 0,
  goldOz: 0
};

/* ===== GOLD CHART ===== */
new TradingView.widget({
  container_id:"chart",
  autosize:true,
  symbol:"OANDA:XAUUSD",
  interval:"15",
  theme:"dark",
  style:"1",
  locale:"en",
  overrides:{
    "paneProperties.background":"#0f0c05",
    "mainSeriesProperties.candleStyle.upColor":"#ffd700",
    "mainSeriesProperties.candleStyle.downColor":"#cfae3c",
  }
});

/* ===== LIVE GOLD PRICE ===== */
// async function fetchGold(){
//   try{

    
//     const price = 4894.33;
    
//     // const r = await fetch("https://api.metals.dev/v1/metal/spot?api_key=CUGOLDHIGPLTRZDFBN8M334DFBN8M&&metal=gold");
//     // const d = await r.json();
//     // const price = d.rate.price;

//     document.getElementById("goldPrice").textContent =
//       "$"+price.toFixed(2);

//     window.goldPrice = price;

//     // hide loader after first successful fetch
//     document.getElementById("loading").style.display = "none";

//   }catch(e){
//     console.log(e);
//   }
// }

async function fetchGold(){
  try{
    // base price
    let price = 4894.33;

    // fake market movement ±0.3%
    const change = price * (Math.random() * 0.006 - 0.003);
    price += change;

    window.goldPrice = price;

    document.getElementById("goldPrice").textContent =
      "$" + price.toFixed(2);

    document.getElementById("currentPrice").textContent =
      "$" + price.toFixed(2);

    if(position.active){
      const pnl =
        (price - position.entryPrice) * position.goldOz;

      const plEl = document.getElementById("plValue");
      plEl.textContent =
        `${pnl >= 0 ? "+" : ""}${pnl.toFixed(2)} USD`;

      plEl.className = pnl >= 0 ? "profit" : "loss";
    }

    document.getElementById("loading").style.display = "none";

  }catch(e){
    console.log(e);
  }
}

fetchGold();
setInterval(fetchGold,10000);

/* ===== DEMO TRADING ===== */
function buy(){
  const amt = parseFloat(amount.value || 0);
  if(!amt || !window.goldPrice) return;

  position.active = true;
  position.entryPrice = window.goldPrice;
  position.amountUsd = amt;
  position.goldOz = amt / window.goldPrice;

  document.getElementById("entryPrice").textContent =
    "$" + position.entryPrice.toFixed(2);

  document.getElementById("result").innerHTML =
    `Position opened: <b>${position.goldOz.toFixed(4)} oz</b>`;
}

function sell(){
  if(!position.active) return;

  const pnl =
    (window.goldPrice - position.entryPrice) * position.goldOz;

  document.getElementById("result").innerHTML =
    `Position closed. P/L: <b>${pnl >= 0 ? "+" : ""}${pnl.toFixed(2)} USD</b>`;

  position.active = false;
}

</script>

</body>
</html>