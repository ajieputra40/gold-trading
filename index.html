<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="assets/favicon.png">


<title>Gold Trading</title>

<script src="https://s3.tradingview.com/tv.js"></script>

<style>

@font-face {
      font-family: 'Norwester';
      src: url('assets/Norwester.7bf226306214181d5e917ed5bda230.9494f841057c7b5cda3da2221562752f.otf');
    }
body{
  margin:0;
  font-family: 'Norwester', sans-serif;
  color:#f5d27a;
}

/* TOP BAR */
.topbar{
  background:#1a1408;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #3a2b0f;
}

.price{
  font-size:20px;
  font-weight:bold;
  color:#ffd700;
}

.price,
#plValue,
#entryPrice,
#currentPrice{
  font-variant-numeric: tabular-nums;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
}

.logo{
  width:36px;
  height:36px;
  object-fit:contain;
}

.brand-name{
  font-size:18px;
  letter-spacing:1px;
  color:#ffd700;
}

.pair{
  font-size:12px;
  opacity:0.7;
  margin-left:4px;
}

button{
  font-family: 'Norwester', sans-serif;
  background:linear-gradient(90deg,#cfae3c,#ffd700);
  border:none;
  padding:10px 14px;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
  color:#000;
}

/* LAYOUT */
.container{
  display:grid;
  grid-template-columns:1fr 320px;
  height:calc(100vh - 60px);
}

/* CHART */
#chart{
  height:100%;
}

/* SIDE PANEL */
.panel{
  background:#1a1408;
  padding:20px;
  border-left:1px solid #3a2b0f;
}

.panel h3{
  margin-top:0;
  color:#ffd700;
}

.input{
  width:100%;
  padding:10px;
  margin:10px 0;
  background:#2a1f0d;
  border:none;
  color:#fff;
  border-radius:6px;
}

.buy{ background:#2e7d32; color:#fff;width:100%;margin-bottom:10px}
.sell{ background:#c62828; color:#fff;width:100%}

.info{
  font-size:14px;
  margin-top:10px;
}

#positionInfo div{
  display:flex;
  justify-content:space-between;
  margin-top:6px;
}

#plValue.profit{ color:#4caf50; }
#plValue.loss{ color:#f44336; }
  
  
#loading{
  position:fixed;
  inset:0;
  background:#0f0c05;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.spinner{
  width:56px;
  height:56px;
  border-radius:50%;
  border:5px solid rgba(255,215,0,0.2);
  border-top:5px solid #ffd700;
  animation:spin 1s linear infinite;
}

.loading-text{
  margin-top:14px;
  font-size:14px;
  letter-spacing:0.5px;
  color:#c9b37a;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}

/* ===== MOBILE RESPONSIVE ===== */
@media (max-width: 900px){
  .container{
    grid-template-columns: 1fr;
    height:auto;
  }

  #chart{
    height:60vh;
  }

  .panel{
    border-left:none;
    border-top:1px solid #3a2b0f;
  }
}

@media (max-width: 480px){
  .topbar{
    padding:10px 14px;
  }

  .brand-name{
    font-size:16px;
  }

  .price{
    font-size:16px;
  }

  button{
    padding:12px;
    font-size:15px;
  }

  .input{
    padding:12px;
    font-size:16px;
  }
}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
}

.modal-box{
  background:#1a1408;
  border:1px solid #3a2b0f;
  padding:20px;
  width:90%;
  max-width:380px;
  border-radius:10px;
  text-align:center;
}

.modal-box h3{
  margin-top:0;
  color:#ffd700;
}

.modal-box button{
  width:100%;
  margin-top:10px;
}

.modal-box .secondary{
  background:#2a1f0d;
  color:#ffd700;
}


</style>
</head>

<body>

  <div id="loading">
    <div class="spinner"></div>
    <div class="loading-text">Loading Gold Market‚Ä¶</div>
  </div>

<div class="topbar">
  <div class="brand">
    <img src="assets/logo.png" alt="AurumX" class="logo">
    <span class="brand-name">AurumX</span>
    <span class="pair">XAUUSD</span>
  </div>
  <div class="price" id="goldPrice">$--</div>
</div>

<div class="container">

  <!-- CHART -->
  <div id="chart"></div>

  <!-- TRADE PANEL -->
  <div class="panel">
    <h3>Trade Gold</h3>

    <label>Amount (USD)</label>
    <input id="amount" class="input" type="number" placeholder="100">

    <button class="buy" onclick="buy()">Buy Gold</button>
    <button class="sell" onclick="sell()">Sell Gold</button>

    <div class="info" id="positionInfo">
      <div>Entry Price: <b id="entryPrice">--</b></div>
      <div>Current Price: <b id="currentPrice">--</b></div>
      <div>P/L: <b id="plValue">--</b></div>
    </div>

    <div class="info" id="result"></div>
  </div>

</div>

<script>

const PROFIT_RATE = 0.20;

let position = {
  active: false,
  entryPrice: 0,
  amountUsd: 0,
  goldOz: 0
};

/* ===== GOLD CHART ===== */
new TradingView.widget({
  container_id:"chart",
  autosize:true,
  symbol:"OANDA:XAUUSD",
  interval:"W",
  theme:"dark",
  style:"1",
  locale:"en",
  overrides:{
    "paneProperties.background":"#0f0c05",
    "mainSeriesProperties.candleStyle.upColor":"#ffd700",
    "mainSeriesProperties.candleStyle.downColor":"#cfae3c",
  }
});

/* ===== LIVE GOLD PRICE ===== */
// async function fetchGold(){
//   try{

    
//     const price = 4894.33;
    
//     // const r = await fetch("https://api.metals.dev/v1/metal/spot?api_key=CUGOLDHIGPLTRZDFBN8M334DFBN8M&&metal=gold");
//     // const d = await r.json();
//     // const price = d.rate.price;

//     document.getElementById("goldPrice").textContent =
//       "$"+price.toFixed(2);

//     window.goldPrice = price;

//     // hide loader after first successful fetch
//     document.getElementById("loading").style.display = "none";

//   }catch(e){
//     console.log(e);
//   }
// }

async function fetchGold(){
  try{
    // base price
    let price = 4894.33;

    // fake market movement ¬±0.3%
    const change = price * (Math.random() * 0.006 - 0.003);
    price += change;

    window.goldPrice = price;

    document.getElementById("goldPrice").textContent =
      "$" + price.toFixed(2);

    document.getElementById("currentPrice").textContent =
      "$" + price.toFixed(2);

    if(position.active){
      // fake growing profit up to 20%
      const targetProfit = position.amountUsd * PROFIT_RATE;

      // make profit "grow" smoothly
      if(!position.fakeProfit) position.fakeProfit = 0;
      position.fakeProfit += targetProfit * 0.08; // grows 8% per tick

      if(position.fakeProfit > targetProfit){
        position.fakeProfit = targetProfit;
      }

      const plEl = document.getElementById("plValue");
      plEl.textContent = `+${position.fakeProfit.toFixed(2)} USD`;
      plEl.className = "profit";
    }

    document.getElementById("loading").style.display = "none";

  }catch(e){
    console.log(e);
  }
}

fetchGold();
setInterval(fetchGold,10000);

/* ===== DEMO TRADING ===== */
function buy(){
  if(position.active) return;

  const amt = parseFloat(amount.value || 0);
  if(!amt || !window.goldPrice) return;

  position.active = true;
  position.entryPrice = window.goldPrice;
  position.amountUsd = amt;
  position.goldOz = amt / window.goldPrice;

  document.getElementById("entryPrice").textContent =
    "$" + position.entryPrice.toFixed(2);

  document.getElementById("result").innerHTML =
    `Position opened: <b>${position.goldOz.toFixed(4)} oz</b>`;

  openBankModal("buy");
}

function sell(){
  if(!position.active) return;

  // Dummy fixed profit: 20% of the amount
  const pnl = position.amountUsd * PROFIT_RATE;

  position.active = false;

  showProfit(pnl);
  openBankModal("sell");

  // reset UI position
  document.getElementById("entryPrice").textContent = "--";
  document.getElementById("plValue").textContent = "--";
  document.getElementById("plValue").className = "";
}

let currentAction = "";

function openBankModal(action){
  currentAction = action;
  document.getElementById("bankModal").style.display = "flex";
}

function closeModal(){
  document.getElementById("bankModal").style.display = "none";
}

function confirmTransfer(){
  const bank = bankName.value;
  const name = accountName.value;
  const acc = accountNumber.value;

  if(!bank || !name || !acc){
    alert("Please complete bank information");
    return;
  }

  closeModal();
  // alert("Transfer instruction created (demo)");
}

function showProfit(pnl){
  const el = document.getElementById("profitText");
  el.innerHTML =
    pnl >= 0
      ? `üéâ You made a profit of <b style="color:#4caf50;">+${pnl.toFixed(2)} USD</b>`
      : `‚ö†Ô∏è You had a loss of <b style="color:#f44336;">${pnl.toFixed(2)} USD</b>`;

  document.getElementById("profitModal").style.display = "flex";
}

function closeProfit(){
  document.getElementById("profitModal").style.display = "none";
}

</script>

<div id="bankModal" class="modal">
  <div class="modal-box">
    <h3>Complete Your Transaction</h3>

    <label>Bank</label>
    <select id="bankName" class="input">
      <option value="">Select Bank</option>
      <option>BCA</option>
      <option>Mandiri</option>
      <option>BNI</option>
      <option>BRI</option>
    </select>

    <label>Account Name</label>
    <input id="accountName" class="input" placeholder="John Doe">

    <label>Account Number</label>
    <input id="accountNumber" class="input" placeholder="1234567890">

    <button onclick="confirmTransfer()">Confirm Transfer</button>
    <button class="secondary" onclick="closeModal()">Cancel</button>
  </div>
</div>

<div id="profitModal" class="modal">
  <div class="modal-box">
    <h3>Transaction Result</h3>
    <p id="profitText"></p>
    <button onclick="closeProfit()">Done</button>
  </div>
</div>

</body>
</html>